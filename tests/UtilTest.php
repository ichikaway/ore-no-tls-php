<?php

use PHPTLS\Tls\Util;
use PHPUnit\Framework\TestCase;

class UtilTest extends TestCase
{
    public function testGetByteDataWithLen()
    {
        $hexString = "160303004a0200004603034016c02bfc25c39437c523f7b9cda73d7ecc0fd1309b8c9aafd884f4a45591552075654b2e5fff2ad6517ab57acc7a977a985e3e802723350a3798daf9d11de108009c00";
        $expectedValue = "004a";
        $this->assertEquals($expectedValue, Util::getHexDataWithLen($hexString, 3, 2));
    }

    public function testDecToHexWithLen()
    {
        $dec = 77;
        $len = 2;
        $expect = '004D';
        $this->assertEquals($expect, Util::decToHexWithLen($dec, $len));
    }

    public function testHex2Pem()
    {
        $data = '308206423082052aa003020102020c5659f5c44004d7574df96c68300d06092a864886f70d01010b0500304c310b300906035504061302424531193017060355040a1310476c6f62616c5369676e206e762d73613122302006035504031319416c70686153534c204341202d20534841323536202d204734301e170d3233303833303038333330385a170d3234303933303038333330375a30163114301206035504030c0b2a2e76616464792e6e657430820122300d06092a864886f70d01010105000382010f003082010a0282010100d730582c120df024fdbf07917e9fb44b338b99e3984eb4ef4b420d267252fab8fb52f4aec5cc987d1391515b1f14814b23811e19172b879f1e8c030f9223f50b8a69a64693fd0185f9a866612817713af838b5c4146ba315c517933bf6e2ffaa8895590e124bee451017a88534c71363ddb6b3927b00f4854475cc082d36dc1e6d0867b2b6d9b5aed4af48ec8156fa6ad1d5f8f8c720fd9ada7b0ecdce1ac8628038f78c5aa07cd3fe33705070c46a40e9232f875ea27d72210750bdb6273b1e159f296c448b382ad37f7f4f8943df8e3a4657967d880e0f0ea3d663832814e0cf26bf59b265338109023342fd199143dc56a6a2f2bdd116118ca3aa705fa8170203010001a382035830820354300e0603551d0f0101ff0404030205a0300c0603551d130101ff0402300030819306082b06010505070101048186308183304606082b06010505073002863a687474703a2f2f7365637572652e676c6f62616c7369676e2e636f6d2f6361636572742f616c70686173736c636173686132353667342e637274303906082b06010505073001862d687474703a2f2f6f6373702e676c6f62616c7369676e2e636f6d2f616c70686173736c6361736861323536673430570603551d200450304e3008060667810c0102013042060a2b06010401a0320a01033034303206082b06010505070201162668747470733a2f2f7777772e676c6f62616c7369676e2e636f6d2f7265706f7369746f72792f30410603551d1f043a30383036a034a0328630687474703a2f2f63726c2e676c6f62616c7369676e2e636f6d2f616c70686173736c636173686132353667342e63726c30210603551d11041a3018820b2a2e76616464792e6e6574820976616464792e6e6574301d0603551d250416301406082b0601050507030106082b06010505070302301f0603551d230418301680144fcbaca8c2efabdd836f6bbfce983d5c58257615301d0603551d0e04160414299c829e37e27e2fdc5c70c64b59933033e3e5943082017e060a2b06010401d6790204020482016e0482016a0168007500eecdd064d5db1acec55cb79db4cd13a23287467cbcecdec351485946711fb59b0000018a45933749000004030046304402206b8911189322ebf4ae99f297fa4c1ec1602c0fdae68f838a53b5e44c1192006b022019be9767f09e644b12d7fbaedf3c6d48045593d3a211941c89e4337993e2893300770048b0e36bdaa647340fe56a02fa9d30eb1c5201cb56dd2c81d9bbbfab39d884730000018a459337590000040300483046022100bcfef20664bc471832c0463cd841b6554f1179aa7a4d81a03417606bd6c4ada4022100b8272131e78e6f7fa527a66023c0e96d36eb87e719b58fa5b75f1f2dc283da55007600dab6bf6b3fb5b6229f9bc2bb5c6be87091716cbb51848534bda43d3048d7fbab0000018a4593377a000004030047304502210083e32347fc83f1ceec102eff909c64e0a6de5415eef01068f9e7e83f150c6eef02201796df9cf04162d3113fdc427db4c955621ced527ab5296936363b2c415fb044300d06092a864886f70d01010b0500038201010075398c7494d93aa674574094a67be43a8fd86b408a984193c526f532e009413f6d87df156f5b7e21b16dc8f2ce39cc4d284aed44c931188eb76ff81213cc3984722229e8f98de7684992d8bac0e2aca2ec1baeec7705dbc28a006472a1dc3ae975b13b788206e6afcb90583944da7f7826cd035f1959e8d4cacb0e46ea4cc0101c729824d1b026895f48879506dc2b5c1ac42db87999b4dd53ac958a0679573b2b131b367605144febddbea77a18d606d1dc09f4dcb4e77f3e732751fd136e1d70282f1ccc6dcbd1b684a2aa622a9473f2c6182bb90d6856d57cda695becf4a7596c8c369679f6e86a17b2c466b4c3349853e7c858d5a500d64b7f559fc43338';
        $expect = '-----BEGIN CERTIFICATE-----
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
-----END CERTIFICATE-----';

        $result = Util::hexToPem($data);
        $this->assertEquals($expect, $result);
    }
}
